

# ORION Design System Web Component Library

ORION is United's employee experience design system developed to create cohesive, consistent experiences across digital employee applications. Additional information regarding the ORION Design System can be found on the documentation site at [https://orion.united.com/](https://orion.united.com/).

This repository contains the source code for ORION's web component library.

## Table of Contents

 - [Setup](#setup)
 - [Documentation Tips](#documentation_tips)
	 - [General Component Information](#general_component_information)
	 - [Props](#props) 
	 - [Events](#events)
	 - [Slots](#slots) 
	 - [Shadow Parts](#shadow_parts) 
	 - [CSS Variables](#css_variables) 
 - [Storybook Tips](#storybook_tips) 
	 - [Log Emitted Events in Actions Tab](#log_emitted_events_in_actions_tab)
	 - [Creating Template Functions](#creating_template_functions)
	 - [Adding notes to a specific story](#adding_notes_to_a_specific_story)
	 - [Adding Story Specific Controls](#adding_story_specific_controls)
 - [Running Locally](#running_locally)
 - [Testing Locally](#testing_locally)
 - [Releasing](#releasing)

<div id="setup"></div>

## Setup
Follow these steps to setup the repo locally:
1. Ensure that you are connected to the United VPN
2. Ensure that you are using node `v14.0.0` and above. We suggest using `v16.17.0`.
3. If you have not done so yet, configure `npm` to use `Artifactory`:
<pre>
Log in to Artifactory Cloud and generate token:

https://artifactorycloud.ual.com/ui/

Click on "Welcome, uID" dropdown

Select "Set Me Up"

<img width="290" alt="Screen Shot 2023-04-27 at 12 19 48 PM" src="https://user-images.githubusercontent.com/112984366/234940321-ba205f1a-3488-41b9-833b-782846e1ede4.png">

Select "npm"

Change repository to "l-npm"

Click on "Generate Token & Create Instructions"

// Config npm to use @orion scope
$ npm config set @orion:registry https://artifactorycloud.ual.com/artifactory/api/npm/l-npm/

// Add log in information to npm for @orion scope
$ npm login --scope=@orion --registry=https://artifactorycloud.ual.com/artifactory/api/npm/l-npm/

// Base64 encode your United password
$ echo -n '&lt;PASSWORD&gt;' | base64

// Open your `.npmrc` file
$ open ~/.npmrc

// Add the following content to the bottom of the file, 
replacing the &lt;PLACEHOLDERS&gt; with your actual info. Save and close.

@orion:registry=https://artifactorycloud.ual.com/artifactory/api/npm/l-npm/
//artifactorycloud.ual.com/artifactory/api/npm/l-npm/:_password=&lt;BASE64_PASSWORD&gt;
//artifactorycloud.ual.com/artifactory/api/npm/l-npm/:username=&lt;YOUR_UID&gt;@global.ual.com
//artifactorycloud.ual.com/artifactory/api/npm/l-npm/:email=&lt;YOUR_EMAIL_USERNAME&gt;@united.com
//artifactorycloud.ual.com/artifactory/api/npm/v-npm/:always-auth=true

</pre>
4. Explicitly set unscoped packages to use the standard npm registry
<pre>
$ npm config set registry=https://registry.npmjs.org
</pre>
5. Run `$ npm install` from project `root` directory (e.g. `../../orion-design-system`)

**Note**: <br/>
Documenation on available scripts and their descriptions can be found in `SCRIPTS.md`

<div id="documentation_tips"></div>

## Documentation Tips
Stencil provides the ability for a component's API (props, events, slots, shadow parts, and css variables) documentation to be auto generated from the codebase. This autogenerated documentation is automatically integrated into a component's Storybook docs page as well. Here are some tips on how to add documentation to the code so that it can be incorporated into these tools.

<div id="general_component_information"></div>

### General Component Information
General information about the component can be added into the component's readme file. This content should live above the `<!-- Auto Generated Below -->` tag.

**Note**: <br/>
If you are running in dev mode (`npm run dev-storybook`), the general information updates to this file will not be updated in the Storybook docs as part of the live reload. This seems to be because the `readme.md` file is not watched by Stencil. Additional information related to this can be found here in this [GitHub Issue](https://github.com/pixtron/storybook-addon-docs-stencil/issues/3). To see the updates in the Storybook docs, `npm run dev-storybook` needs to be run again.

```md
// src/components/orion-some-component/readme.md
# orion-some-component
The `orion-some-component` can be used for xyz purpose and in these scenarios...
...

<!-- Auto Generated Below -->
```

<div id="props"></div>

### Props
Props, their type, and their default value are automatically added to a component's Storybook controls and args table. Additional descriptions for each prop can be added via comments above where the prop is defined:

```js
export class OrionSomeComponent {
  /**
   * Disables interactions
   */
  @Prop() disabled: boolean = false;
}
```

<div id="events"></div>

### Events
Emitted events and their value type are automatically added to a component's Storybook args table. Additional descriptions can be added for each event via comments above where the event is defined:
```js
export class OrionSomeComponent {
  /**
   * CustomEvent `detail` will be the updated value
   */
  @Event() valueChanged: EventEmitter<number>;
  private onInputChangeValue(event: Event) {}
}
```

<div id="slots"></div>

### Slots
Slots that are available in the component can be defined above the component declaration using jsDoc style comments with the `@slot` tag:
```js
/**
 * @slot default - default slot
 * @slot footer - slot for footer content
 */
@Component({
  tag: 'orion-some-component',
  styleUrl: 'orion-some-component.css',
  shadow: true,
})
export class OrionSomeComponent {
  render () {
    return (
      <div class="orion-some-component">
        <slot />
        <slot name="footer" />
      </div>
    )
  }
}

```

<div id="shadow_parts"></div>

### Shadow Parts
Shadown parts that are available in the component can be defined above the component declaration using jsDoc style comments with the `@part` tag:
```js
/**
 * @part wrapper - wrapper container
 */
@Component({
  tag: 'orion-some-component',
  styleUrl: 'orion-some-component.css',
  shadow: true,
})
export class OrionSomeComponent {
  render () {
    return (
      <div class="orion-some-component">
        <div part="wrapper">
          <slot />
        </div>
      </div>
    )
  }
}

```

<div id="css_variables"></div>

### CSS Variables
Customizeable CSS variables can be defined in the CSS file using jsDoc style comments with the `@prop` tag:

```css
/**
 * @prop --orion-some-component-background-color: hex value of the background color
 * @prop --orion-some-component-font-size: rem value of the font size
 */
.orion-some-component {
  background-color: var(--orion-some-component-background-color, black);
  font-size: var(--orion-some-component-font-size, 1rem);
}

```

<div id="storybook_tips"></div>

## Storybook Tips
The [Storybook website](https://storybook.js.org/) is great resource to learn about writing stories. In addition to the website, the following tips may also be useful:

<div id="log_emitted_events_in_actions_tab"></div>

### Log Emitted Events in Actions Tab
If the component emits an event, stories can be configured to listen to the event and log the event object in the Actions tab. This is a great way to make sure events are being fired and to make it easy to inspect the data being emitted. To add event listening, configure the `parameters` object:

```js
export default {
  title: 'Components/orion-component-name',
  parameters: {
    // Listen to the "keyup", "click", and "valueChanged" events in the Actions tab
    actions: {
      handles: ['keyup', 'click', 'valueChanged']
    }
  },
  component: 'orion-component-name',
}
```

<div id="creating_template_functions"></div>

### Creating Template Functions
#### Adding scripts
When adding a `<script>` to the template, wrap the code in a self invoking function so that variables have their own scope and will not collide with any globally declare variables.

This issue can be seen when you click into a story (e.g Story A), then go to another story (e.g. Story B), and come back the first story (e.g. Story A). Here's an example:
```html
<!-- BAD -->
<orion-button>Trigger</orion-button>

<script>
  const button = document.querySelector('orion-button')   // This became a global variable
  button.addEventListener('click', () => console.log('clicked'))
</script>
```
When you first come to this story, everything works. However, if you go to another story and then come back, you'll get the error below because `button` is a global variable that was previously declared during the first visit of the story.
```js
Uncaught SyntaxError: Identifier 'button' has already been declared
```

To get around this, wrap your logic inside of a self invoking function:
```html
<!-- Good -->
<orion-button>Trigger</orion-button>

<script>
  (function () {
    const button = document.querySelector('orion-button')
    button.addEventListener('click', () => console.log('clicked'))
  })()
</script>
```

#### Check the spacing and formatting
When creating the story markup in a template literal, check the rendered story to ensure the markup has the correct spacing and is correct. This will allow users of the library to copy the code and not have to do any additional formatting and provide a better experience. Checking can be done in the "Docs" tab. Go to the story and click on the "Show code" button in the bottom right corner and verify the code is formatted correctly.

<div id="adding_notes_to_a_specific_story"></div>

### Adding notes to a specific story
Notes can be added to an individual story to provide additional information and context about that specific story. These notes will appear in the "Docs" tab under the story's title. To add story specific notes, update the `parameters` object of the story:
```js
export const MaxReachedExample = Template.bind({})
MaxReachedExample.parameters = {
  docs: {
    description: {
      story: 'When the `max` value is reached. The increment button will be disabled'
    }
  }
}
```

<div id="adding_story_specific_controls"></div>

### Adding story specific controls
Sometimes you may want to add controls to a story to provide a more interactive story. You can do this by adding additional properties to the `args` object that is used in the `Template` function.

For example, in the `orion-modal` component, `isOpen`, `hasCancelIcon`, and `isFullScreen` are `orion-modal` props and thus are part of the component API. In the code below, we are adding two additional properties (`showTitleSlot` and `showBodySlot`) to allow the users to toggle on/off the slot content. These controls (`showTitleSlot` and `showBodySlot`) are only for this story and are not part of the `orion-modal` component API.
```js
const Template = (args) => `
  <orion-modal
    ${ args.hasCancelIcon ? 'has-cancel-icon' : '' }
    ${ args.isFullScreen ? 'is-full-screen' : '' }
    ${ args.isOpen ? 'is-open' : '' }
  >
    ${ args.showTitleSlot ? '<h3 slot="orion-modal-title">Title</h3>' : ''}
    ${ args.showBodySlot ? '<div slot="orion-modal-body">Body</div>' : ''}
  </orion-modal>
`
```
Because `showTitleSlot` and `showBodySlot` are part of the `args` object, they will also appear in the ArgsTable. To let the user know that these are not part of the component API and are only used in the story, we can add a description to these controls and list them under their own category:
```js
export default {
  title: 'Components/orion-modal',
  component: 'orion-modal',
  // Configuring the these Storybook only controls to appear under
  // the same category in the ArgsTable
  argTypes: {
    showTitleSlot: {
      description: `**NOT PART OF COMPONENT API**. Toggle the \`orion-modal-title\` slot in this storybook story`,
      table: {
        category: `Story Controls. Not component API`
      }
    },
    showBodySlot: {
      description: `**NOT PART OF COMPONENT API**. Toggle the \`orion-modal-body\` slot in this storybook story`,
      table: {
        category: `Story Controls. Not component API`
      }
    },
  }
}
```
If instead we wanted to hide these controls so that they do not show up the ArgsTable, we can do that by:
```js
export default {
  title: 'Components/orion-modal',
  component: 'orion-modal',
  // Prevent these controls from showing up in the ArgsTable
  argTypes: {
    showTitleSlot: {
      table: {
        disable: true
      }
    },
    showBodySlot: {
      table: {
        disable: true
      }
    },
  }
}
```

<div id="running_locally"></div>

## Running Locally

1. Navigate to `/packages/orion-design-system`
2. Run `npm start`

<div id="testing_locally"></div>

## Testing Locally

Visual accuracy should be tested for desktop on **Edge, Chrome, and Firefox** and for mobile on **iPhone/Android** devices.

> Current as of 03/14/2023

| Browser            | Supported Version (modern - 2) |
| ------------------ | ------------------------------ |
| Chrome             | 111                            |
| Edge               | 108                            |
| Safari             | 14                             |
| Firefox            | 110                            |
| Safari iOS         | 14                             |
| Chrome for Android | 108                            |

**Responsiveness** should also be tested using in-browser tools.

### Desktop Testing

All four browsers are available on both macOS and Windows.

### Mobile Testing

1. Find your local ip address
2. Run `npm start --host <ip>`
3. Navigate to `http://<ip>:3333/` from your mobile device

While testing on a real device is most likely the easiest

- xCode comes with an iOS simulator (macOS only)
- Android Studio can be used to setup an Android Virtual Device (AVD)

<div id="releasing"></div>

## Releasing

1. PR and merge your working branch into `main`
1. Merge automated Release PR. This will update the `package.json` version, generate changelog entries, and apply them to CHANGELOG.md
1. Navigate to project root `../../{your-folder}`
1. Disconnect from any private VPNs or connect to the United VPN
1. Run `$ npm run deploy` and follow the prompts

